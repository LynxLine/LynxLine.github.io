<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
        }
    </style>

    
    
    
    
    
    

    
    <title>Lab 7, linking, planning next</title>
    <meta name="description" content="">
    <meta name="keywords" content='Blog, Inferno OS, Raspberry Pi, Research'>

    <meta property="og:url" content="https://lynxline.com/posts/lab-7-linking-more-initialization/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Lab 7, linking, planning next">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://lynxline.com/images/lynx.jpg">
    <meta property="og:image:secure_url" content="https://lynxline.com/images/lynx.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Lab 7, linking, planning next">
    <meta name="twitter:description" content="">
    <meta property="twitter:domain" content="https://lynxline.com/posts/lab-7-linking-more-initialization/">
    <meta property="twitter:url" content="https://lynxline.com/posts/lab-7-linking-more-initialization/">
    <meta name="twitter:image" content="https://lynxline.com/images/lynx.jpg">

    
    <link rel="canonical" href="https://lynxline.com/posts/lab-7-linking-more-initialization/" />

    
    <link rel="stylesheet" type="text/css" href="/css/normalize.min.css" media="print">

    
    <link rel="stylesheet" type="text/css" href="/css/main.min.css">

    
    <link id="dark-theme" rel="stylesheet" href="/css/dark.min.css">

    
    <script src="/js/bundle.min.c60dbb422ed053b0761160e3a3f08b9af2060f00adc8f12c0ff21a8cf55b3d8e.js" integrity="sha256-xg27Qi7QU7B2EWDjo/CLmvIGDwCtyPEsD/IajPVbPY4="></script>

    
    
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="https://lynxline.com/">
                <img src='/images/lynx.jpg' alt="avatar" />
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="https://lynxline.com/">LynxLine</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://lynxline.com/services/"><span data-feather='zap'></span> Services </a>
            </div>
            
            <div class="nav-link">
                <a href="https://lynxline.com/posts/"><span data-feather='layers'></span> Posts </a>
            </div>
            
            <div class="nav-link">
                <a href="https://lynxline.com/tags/"><span data-feather='tag'></span> Tags </a>
            </div>
            
            <div class="nav-link">
                <a href="https://lynxline.com/contact/"><span data-feather='mail'></span> Contact </a>
            </div>
            
            <div class="nav-link">
                <a href="https://github.com"><span data-feather='github'></span>  </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span id="dark-theme-toggle-screen-reader-target" class="sr-only"></span>
                <a>
                    <span id="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span id="hamburger-menu-toggle-screen-reader-target" class="sr-only">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://lynxline.com/services/"><span data-feather='zap'></span> Services </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://lynxline.com/posts/"><span data-feather='layers'></span> Posts </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://lynxline.com/tags/"><span data-feather='tag'></span> Tags </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://lynxline.com/contact/"><span data-feather='mail'></span> Contact </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://github.com"><span data-feather='github'></span>  </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span id="dark-theme-toggle-screen-reader-target" class="sr-only">theme</span>
                    <a>
                        <span id="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>Lab 7, linking, planning next</h1>
        <small role="doc-subtitle"></small>
        <p class="post-date">December 17, 2012
        
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="https://lynxline.com/tags/blog">Blog</a></li>
        
            <li class="post-tag"><a href="https://lynxline.com/tags/inferno-os">Inferno OS</a></li>
        
            <li class="post-tag"><a href="https://lynxline.com/tags/raspberry-pi">Raspberry Pi</a></li>
        
            <li class="post-tag"><a href="https://lynxline.com/tags/research">Research</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <p>As we have the kernel almost compiled now it is time to check what is missing to have it linked. By checking header files and adding stubs into main.c we will get linked with very small changes as:</p>
<p>Changes to <strong>main.c:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;u.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;../port/lib.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;dat.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;mem.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>Conf conf;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>Mach <span style="color:#f92672">*</span>m <span style="color:#f92672">=</span> (Mach<span style="color:#f92672">*</span>)MACHADDR;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>Proc <span style="color:#f92672">*</span>up <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;../port/uart.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span><span style="color:#75715e"></span>PhysUart<span style="color:#f92672">*</span> physuart[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span><span style="color:#66d9ef">int</span>     <span style="color:#a6e22e">waserror</span>(<span style="color:#66d9ef">void</span>) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span><span style="color:#66d9ef">int</span>     <span style="color:#a6e22e">splhi</span>(<span style="color:#66d9ef">void</span>) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">splx</span>(<span style="color:#66d9ef">int</span>) { <span style="color:#66d9ef">return</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span><span style="color:#66d9ef">int</span>     <span style="color:#a6e22e">spllo</span>(<span style="color:#66d9ef">void</span>) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">splxpc</span>(<span style="color:#66d9ef">int</span>) { <span style="color:#66d9ef">return</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span><span style="color:#66d9ef">int</span>     <span style="color:#a6e22e">islo</span>(<span style="color:#66d9ef">void</span>) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span><span style="color:#66d9ef">int</span>     <span style="color:#a6e22e">setlabel</span>(Label<span style="color:#f92672">*</span>) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">gotolabel</span>(Label<span style="color:#f92672">*</span>) { <span style="color:#66d9ef">return</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>ulong   <span style="color:#a6e22e">getcallerpc</span>(<span style="color:#66d9ef">void</span><span style="color:#f92672">*</span>) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span><span style="color:#66d9ef">int</span>     <span style="color:#a6e22e">segflush</span>(<span style="color:#66d9ef">void</span><span style="color:#f92672">*</span>, ulong) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">idlehands</span>(<span style="color:#66d9ef">void</span>) { <span style="color:#66d9ef">return</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">kprocchild</span>(Proc <span style="color:#f92672">*</span>p, <span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span>func)(<span style="color:#66d9ef">void</span><span style="color:#f92672">*</span>), <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>arg) { <span style="color:#66d9ef">return</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>ulong   <span style="color:#a6e22e">_tas</span>(ulong<span style="color:#f92672">*</span>) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>ulong   <span style="color:#a6e22e">_div</span>(ulong<span style="color:#f92672">*</span>) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>ulong   <span style="color:#a6e22e">_divu</span>(ulong<span style="color:#f92672">*</span>) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>ulong   <span style="color:#a6e22e">_mod</span>(ulong<span style="color:#f92672">*</span>) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>ulong   <span style="color:#a6e22e">_modu</span>(ulong<span style="color:#f92672">*</span>) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">setpanic</span>(<span style="color:#66d9ef">void</span>) { <span style="color:#66d9ef">return</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">dumpstack</span>(<span style="color:#66d9ef">void</span>) { <span style="color:#66d9ef">return</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">exit</span>(<span style="color:#66d9ef">int</span>) { <span style="color:#66d9ef">return</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">reboot</span>(<span style="color:#66d9ef">void</span>) { <span style="color:#66d9ef">return</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">halt</span>(<span style="color:#66d9ef">void</span>) { <span style="color:#66d9ef">return</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span><span>Timer<span style="color:#f92672">*</span>  <span style="color:#a6e22e">addclock0link</span>(<span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span>)(<span style="color:#66d9ef">void</span>), <span style="color:#66d9ef">int</span>) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">clockcheck</span>(<span style="color:#66d9ef">void</span>) { <span style="color:#66d9ef">return</span>; }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">fpinit</span>(<span style="color:#66d9ef">void</span>) {}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">FPsave</span>(<span style="color:#66d9ef">void</span><span style="color:#f92672">*</span>) {}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span><span><span style="color:#66d9ef">void</span>    <span style="color:#a6e22e">FPrestore</span>(<span style="color:#66d9ef">void</span><span style="color:#f92672">*</span>) {}
</span></span></code></pre></div><p>Changes to <strong>fns.h:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#75715e">#define coherence()     </span><span style="color:#75715e">/* nothing needed for uniprocessor */</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#75715e">#define procsave(p)     </span><span style="color:#75715e">/* Save the mach part of the current */</span><span style="color:#75715e"> 
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#75715e"></span>                        <span style="color:#75715e">/* process state, no need for one cpu */</span>
</span></span></code></pre></div><p>This list of functions defines very clear what are scopes of functionality is required to implement. For example, fpinit, FPsave, FPrestore are related to have floating point operations, “clock” functions to have system clocks to be programmed and tested. Some functions for rebooting, halting, dumping stack – say they are “util” functions. And finally block of functions (which is first in list) is to be implemented in assembler to have kernel to use R-Pi platform.</p>
<p>You see that we make “empty” defines for <em>coherence()</em> and <em>procsave()</em>, so probably in future for graphics codes, the <em>coherence()</em> should have something on board, but for our current state it is fine.</p>
<p>My plan for a next lab is to describe memory model and initial initializations for memory pools.</p>
<p>FILES:</p>
<ul>
<li><a href="fns.h">os/rpi/fns.h</a></li>
<li><a href="main.c">os/rpi/main.c</a></li>
<li><a href="rpi">os/rpi/rpi</a></li>
</ul>

        </p>
        
    </div>

    <div class="prev-next">
        
    </div>

    
    
    
</div>



    

        </main><footer class="footer">
    
    

    
    <span>
        Made using <a target="_blank" href="https://gohugo.io/">HUGO</a>
    </span>
</footer>
</body>
</html>
